import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
from sklearn.ensemble import RandomForestClassifier
import time

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©
st.set_page_config(page_title="JAI - Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù‚Ù„Ø¨", page_icon="â¤ï¸", layout="wide")

# Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
if 'page' not in st.session_state: st.session_state.page = "home"
if 'data_history' not in st.session_state:
    st.session_state.data_history = pd.DataFrame(columns=['Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„Ù†Ø¨Ø¶', 'Ø§Ù„Ø¶ØºØ·', 'Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†', 'Ø§Ù„Ø­Ø§Ù„Ø©'])

# Ù†Ù…ÙˆØ°Ø¬ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø³ÙŠØ· Ù„Ù„ØªÙ†Ø¨Ø¤
def predict_risk(hr, bp, ox):
    # Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ø¬Ø¯Ø§Ù‹
    if hr > 100 or bp > 140 or ox < 90: return "Ø®Ø·Ø±"
    return "Ø·Ø¨ÙŠØ¹ÙŠ"

# --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØµÙØ­Ø§Øª ---
if st.session_state.page == "home":
    st.title("Ø¯ÙˆØ± Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ ÙÙŠ Ø±Ø¹Ø§ÙŠØ© Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù‚Ù„Ø¨ â¤ï¸")
    st.write("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ ÙÙŠ Ù†Ø¸Ø§Ù… JAI Ø§Ù„Ø°ÙƒÙŠ")
    col1, col2, col3 = st.columns(3)
    if col1.button("ðŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©"):
        st.session_state.page = "simulation"
        st.rerun()
    if col2.button("ðŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶"):
        st.session_state.page = "data"
        st.rerun()
    if col3.button("âš ï¸ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª"):
        st.session_state.page = "alerts"
        st.rerun()

elif st.session_state.page in ["simulation", "data"]:
    st.header("ðŸ“Š Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©")
    # ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
    hr, bp, ox = np.random.randint(60,110), np.random.randint(100,160), np.random.randint(88,100)
    status = predict_risk(hr, bp, ox)
    
    # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    new_entry = pd.DataFrame({'Ø§Ù„ÙˆÙ‚Øª': [time.strftime("%H:%M:%S")], 'Ø§Ù„Ù†Ø¨Ø¶': [hr], 'Ø§Ù„Ø¶ØºØ·': [bp], 'Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†': [ox], 'Ø§Ù„Ø­Ø§Ù„Ø©': [status]})
    st.session_state.data_history = pd.concat([st.session_state.data_history, new_entry], ignore_index=True).tail(10)
    
    st.table(st.session_state.data_history)
    
    if status == "Ø®Ø·Ø±": st.error("ðŸš¨ ØªÙ†Ø¨ÙŠÙ‡: ØªÙ… Ø±ØµØ¯ Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…Ø³ØªÙ‚Ø±Ø©!")
    
    if st.button("Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"):
        st.session_state.page = "home"
        st.rerun()
    time.sleep(5)
    st.rerun()

elif st.session_state.page == "alerts":
    st.header("âš ï¸ Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª")
    st.write(st.session_state.data_history[st.session_state.data_history['Ø§Ù„Ø­Ø§Ù„Ø©'] == "Ø®Ø·Ø±"])
    if st.button("Ø§Ù„Ø¹ÙˆØ¯Ø©"):
        st.session_state.page = "home"
        st.rerun()

st.markdown("<center>ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬Ø© Ø¬ÙˆØ±ÙŠ ðŸ‘‘</center>", unsafe_allow_html=True)
